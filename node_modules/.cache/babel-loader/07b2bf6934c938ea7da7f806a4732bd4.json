{"ast":null,"code":"import _regeneratorRuntime from\"C:/projects/MaxxDogeDapp/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/projects/MaxxDogeDapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/projects/MaxxDogeDapp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import'bootstrap/dist/css/bootstrap.css';import{useDispatch,useSelector}from\"react-redux\";import{updateAccountData,disconnect}from\"../features/blockchain\";import{ethers,utils}from\"ethers\";import{Modal}from\"react-bootstrap\";import Web3Modal from\"web3modal\";import networks from\"../utils/networksMap.json\";import{ownerAddress}from\"../utils/contracts-config\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var eth=window.ethereum;var web3Modal=new Web3Modal();function Connect(){var dispatch=useDispatch();var data=useSelector(function(state){return state.blockchain.value;});var _useState=useState(),_useState2=_slicedToArray(_useState,2),injectedProvider=_useState2[0],setInjectedProvider=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),show=_useState4[0],setShow=_useState4[1];var handleClose=function handleClose(){return setShow(false);};var handleShow=function handleShow(){return setShow(true);};function fetchAccountData(){return _fetchAccountData.apply(this,arguments);}function _fetchAccountData(){_fetchAccountData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var connection,provider,signer,chainId,account,balance;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(typeof window.ethereum!=='undefined')){_context.next=20;break;}_context.next=3;return web3Modal.connect();case 3:connection=_context.sent;provider=new ethers.providers.Web3Provider(connection);setInjectedProvider(provider);signer=provider.getSigner();_context.next=9;return provider.getNetwork();case 9:chainId=_context.sent;_context.next=12;return signer.getAddress();case 12:account=_context.sent;_context.next=15;return signer.getBalance();case 15:balance=_context.sent;dispatch(updateAccountData({account:account,balance:utils.formatUnits(balance),network:networks[String(chainId.chainId)]}));console.log({account:account,balance:utils.formatUnits(balance),network:networks[String(chainId.chainId)]});_context.next=22;break;case 20:console.log(\"Please install metamask\");window.alert(\"Please Install Metamask\");case 22:case\"end\":return _context.stop();}}},_callee);}));return _fetchAccountData.apply(this,arguments);}function Disconnect(){return _Disconnect.apply(this,arguments);}function _Disconnect(){_Disconnect=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:web3Modal.clearCachedProvider();if(!(injectedProvider&&injectedProvider.provider&&typeof injectedProvider.provider.disconnect==\"function\")){_context2.next=5;break;}_context2.next=4;return injectedProvider.provider.disconnect();case 4:setInjectedProvider(null);case 5:dispatch(disconnect());setShow(false);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _Disconnect.apply(this,arguments);}useEffect(function(){if(eth){eth.on('chainChanged',function(chainId){fetchAccountData();});eth.on('accountsChanged',function(accounts){fetchAccountData();});}},[]);var isConnected=data.account!==\"\";return/*#__PURE__*/_jsx(_Fragment,{children:isConnected?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary m-2 rounded\",onClick:handleShow,children:data.account&&\"\".concat(data.account.slice(0,6),\"...\").concat(data.account.slice(data.account.length-6,data.account.length))}),/*#__PURE__*/_jsxs(Modal,{show:show,onHide:handleClose,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"User\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Account: \",data.account]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Balance: \",data.balance&&parseFloat(data.balance).toFixed(4),\" ETH\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Network: \",data.network]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[data.account===ownerAddress?/*#__PURE__*/_jsx(\"a\",{className:\"btn btn-secondary mt-3\",href:\"/owner-dashboard\",role:\"button\",children:\"Dashboard\"}):null,/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger mt-3\",onClick:Disconnect,children:\"Disconnect\"})]})]})]}):/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary m-2 rounded\",onClick:fetchAccountData,src:\"\",children:\"Connect Wallet\"})});}export default Connect;","map":{"version":3,"names":["React","useState","useEffect","useDispatch","useSelector","updateAccountData","disconnect","ethers","utils","Modal","Web3Modal","networks","ownerAddress","eth","window","ethereum","web3Modal","Connect","dispatch","data","state","blockchain","value","injectedProvider","setInjectedProvider","show","setShow","handleClose","handleShow","fetchAccountData","connect","connection","provider","providers","Web3Provider","signer","getSigner","getNetwork","chainId","getAddress","account","getBalance","balance","formatUnits","network","String","console","log","alert","Disconnect","clearCachedProvider","on","accounts","isConnected","slice","length","parseFloat","toFixed"],"sources":["C:/projects/MaxxDogeDapp/src/components/Connect.js"],"sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport { useDispatch, useSelector } from \"react-redux\"\r\nimport { updateAccountData, disconnect } from \"../features/blockchain\"\r\nimport { ethers, utils } from \"ethers\"\r\nimport { Modal } from \"react-bootstrap\"\r\nimport Web3Modal from \"web3modal\"\r\n\r\nimport networks from \"../utils/networksMap.json\"\r\nimport { ownerAddress } from \"../utils/contracts-config\"\r\n\r\n\r\nconst eth = window.ethereum\r\nlet web3Modal = new Web3Modal()\r\n\r\nfunction Connect() {\r\n    const dispatch = useDispatch()\r\n    const data = useSelector((state) => state.blockchain.value)\r\n\r\n    const [injectedProvider, setInjectedProvider] = useState();\r\n    const [show, setShow] = useState(false);\r\n\r\n    const handleClose = () => setShow(false);\r\n    const handleShow = () => setShow(true);\r\n\r\n    async function fetchAccountData() {\r\n        if (typeof window.ethereum !== 'undefined') {\r\n            const connection = await web3Modal.connect()\r\n            const provider = new ethers.providers.Web3Provider(connection)\r\n\r\n            setInjectedProvider(provider);\r\n\r\n            const signer = provider.getSigner()\r\n            const chainId = await provider.getNetwork()\r\n            const account = await signer.getAddress()\r\n            const balance = await signer.getBalance()\r\n\r\n            dispatch(updateAccountData(\r\n                {\r\n                    account: account,\r\n                    balance: utils.formatUnits(balance),\r\n                    network: networks[String(chainId.chainId)]\r\n                }\r\n            ))\r\n            console.log({\r\n                account: account,\r\n                balance: utils.formatUnits(balance),\r\n                network: networks[String(chainId.chainId)]\r\n            })\r\n        }\r\n        else {\r\n            console.log(\"Please install metamask\")\r\n            window.alert(\"Please Install Metamask\")\r\n        }\r\n    }\r\n\r\n    async function Disconnect() {\r\n        web3Modal.clearCachedProvider();\r\n        if (injectedProvider && injectedProvider.provider && typeof injectedProvider.provider.disconnect == \"function\") {\r\n            await injectedProvider.provider.disconnect();\r\n            setInjectedProvider(null)\r\n        }\r\n        dispatch(disconnect())\r\n        setShow(false)\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (eth) {\r\n            eth.on('chainChanged', (chainId) => {\r\n                fetchAccountData()\r\n            })\r\n            eth.on('accountsChanged', (accounts) => {\r\n                fetchAccountData()\r\n            })\r\n        }\r\n    }, [])\r\n\r\n    const isConnected = data.account !== \"\"\r\n\r\n    return (\r\n\r\n        <>\r\n            {isConnected ? (\r\n                <>\r\n                    <button className=\"btn btn-secondary m-2 rounded\"\r\n                        onClick={handleShow}\r\n                    >\r\n                        {data.account &&\r\n                            `${data.account.slice(0, 6)}...${data.account.slice(\r\n                                data.account.length - 6,\r\n                                data.account.length\r\n                            )}`}\r\n                    </button>\r\n                    <Modal show={show} onHide={handleClose}>\r\n                        <Modal.Header closeButton>\r\n                            <Modal.Title>User</Modal.Title>\r\n                        </Modal.Header>\r\n                        <Modal.Body>\r\n                            <p>Account: {data.account}</p>\r\n                            <p>Balance: {data.balance && parseFloat(data.balance).toFixed(4)} ETH</p>\r\n                            <p>Network: {data.network}</p>\r\n                        </Modal.Body>\r\n                        <Modal.Footer>\r\n                            {data.account === ownerAddress ? (\r\n                                <a className='btn btn-secondary mt-3'\r\n                                    href={\"/owner-dashboard\"}\r\n                                    role=\"button\">\r\n                                    Dashboard\r\n                                </a>\r\n                            ) : null}\r\n                            <button\r\n                                className=\"btn btn-danger mt-3\"\r\n                                onClick={Disconnect}>\r\n                                Disconnect\r\n                            </button>\r\n                        </Modal.Footer>\r\n                    </Modal>\r\n                </>\r\n            ) : (\r\n                <button className=\"btn btn-secondary m-2 rounded\" onClick={fetchAccountData} src=\"\">\r\n                    Connect Wallet\r\n                </button>\r\n            )}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default Connect;\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}